\documentclass[author-year, review]{elsarticle} %review=doublespace preprint=single 5p=2 column
%%% Begin My package additions %%%%%%%%%%%%%%%%%%%
\usepackage[hyphens]{url}
\usepackage{lineno} % add 
%\linenumbers % turns line numbering on 
\bibliographystyle{elsarticle-harv}
\biboptions{sort&compress} % For natbib
\usepackage{graphicx}
\usepackage{booktabs} % book-quality tables
%% Redefines the elsarticle footer
\makeatletter
\def\ps@pprintTitle{%
 \let\@oddhead\@empty
 \let\@evenhead\@empty
 \def\@oddfoot{\it \hfill\today}%
 \let\@evenfoot\@oddfoot}
\makeatother

% A modified page layout
\textwidth 6.75in
\oddsidemargin -0.15in
\evensidemargin -0.15in
\textheight 9in
\topmargin -0.5in
%%%%%%%%%%%%%%%% end my additions to header



\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \usepackage{fontspec}
  \ifxetex
    \usepackage{xltxtra,xunicode}
  \fi
  \defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
  \newcommand{\euro}{€}
\fi
% use microtype if available
\IfFileExists{microtype.sty}{\usepackage{microtype}}{}
\usepackage{color}
\usepackage{fancyvrb}
\DefineShortVerb[commandchars=\\\{\}]{\|}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\newenvironment{Shaded}{}{}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
\newcommand{\RegionMarkerTok}[1]{{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
\newcommand{\NormalTok}[1]{{#1}}
\usepackage{graphicx}
% We will generate all images so they have a width \maxwidth. This means
% that they will get their normal width if they fit onto the page, but
% are scaled down if they would overflow the margins.
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
\else\Gin@nat@width\fi}
\makeatother
\let\Oldincludegraphics\includegraphics
\renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=\maxwidth]{#1}}
\ifxetex
  \usepackage[setpagesize=false, % page size defined by xetex
              unicode=false, % unicode breaks when used with xetex
              xetex]{hyperref}
\else
  \usepackage[unicode=true]{hyperref}
\fi
\hypersetup{breaklinks=true,
            bookmarks=true,
            pdfauthor={},
            pdftitle={Avoiding tipping points in the management of ecological systems: a non-parametric Bayesian approach},
            colorlinks=true,
            urlcolor=blue,
            linkcolor=magenta,
            pdfborder={0 0 0}}
\urlstyle{same}  % don't use monospace font for urls
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\setcounter{secnumdepth}{0}
% Pandoc toggle for numbering sections (defaults to be off)
\setcounter{secnumdepth}{0}
% Pandoc header



\begin{document}
\begin{frontmatter}
  \title{Avoiding tipping points in the management of ecological systems: a
         non-parametric Bayesian approach}
  \author[cstar]{Carl Boettiger\corref{cor1}}
  \cortext[cor1]{Corresponding author}
  \ead{cboettig@ucsc.edu}
  \author[cstar]{Marc Mangel}
  \author[noaa]{Stephan B. Munch}
  \address[cstar]{Center for Stock Assessment Research, Department of Applied Math and Statistics, University of California, Mail Stop SOE-2, Santa Cruz, CA 95064, USA}
  \address[noaa]{Southwest Fisheries Science Center, National Oceanic and Atmospheric Administration, 110 Shaffer Road, Santa Cruz, CA 95060, USA}
 \end{frontmatter}


\section{Abstract}

Model uncertainty and limited data coverage are fundamental challenges
to robust ecosystem management. These challenges are acutely highlighted
by concerns that many ecological systems may contain tipping points.
Before a collapse, we do not know where the tipping points lie, if the
exist at all. Hence, we know neither a complete model of the system
dynamics nor do we have access to data in some large region of
state-space where such a tipping point might exist. These two sources of
uncertainty frustrate state-of-the-art parametric approaches to decision
theory and optimal control. I will illustrate how a non-parametric
approach using a Gaussian Process prior provides a more flexible
representation of this inherent uncertainty. Consequently, we can adapt
the Gaussian Process prior to a stochastic dynamic programming framework
in order to make robust management predictions under both model and
uncertainty and limited data.

\section{Introduction}

The sudden collapse of fisheries and other ecosystems is an increasingly
widespread phenomenon and a pressing concern for ecological management
and conservation. Ecological dyanaics are frequently complex and
difficult to measure, making uncertainty in our understanding a
prediction a persistent challenge to effective management.

Decision-theoretic approaches provide a framework to determine the best
sequence of actions in face of uncertainty, but only when that
uncertainty can be meaningfully quantified {[}@Fischer2009{]}.

Uncertainty enters at many levels management

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Why fisheries
\end{itemize}

The economic value and ecological concern have made marine fisheries the
crucible for much of the founding work (Gordon 1954; Reed 1979; May et
al. 1979; Ludwig and Walters 1982) in managing ecosystems under
uncertainty. Global trends (Worm et al. 2006) and controversy (Hilborn
2007; Worm et al. 2009) have made understanding these challenges all the
more pressing.

@Fischer @Sethi2005, @Peretti, @Munch,

(Classical division)

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Dynamic uncertainty (stochasticity)
\end{itemize}

From \href{}{Clark (1976)} to \href{}{Reed (1979)}

Other sources of uncertainty \href{}{Roughgarden \& Smith 1996},
\href{}{Sethi \emph{et al.} (2005)}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Parametric uncertainty 
\end{itemize}

As the parameter values for these models must be estimated from limited
data,\\there will always be some uncertainty associated with these
values. This uncertainty further compounds the intrinsic variability
introduced by demographic or environmental noise. The degree of
uncertainty in the parameter values can be inferred from the data and
reflected in the estimates of the transition probabilities.

(Mangel 1985; Schapaugh and Tyre 2013)

\href{http://doi.org/10.1016/0304-38008290023-0}{Ludwig \& Walters 1982}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Structural uncertainty 
\end{itemize}

Estimates of parameter uncertainty are only as good as the parametric
models themselves. Often we do not understand the system dynamics well
enough to know if a model provides a good approximation over the
relevant range of states and timescales (criteria that we loosely refer
to as defining the ``right'' or ``true'' model.) So called structural or
model uncertainty is a more difficult problem than parametric
uncertainty. Typical solutions involve either model choice, model
averaging, or introducing yet greater model complexity of which others
may be special cases (model averaging being one such way to construct
such a model) {[}B. K. Williams (2001); Athanassoglou and Xepapadeas
(2012); @Cressie2009{]}. Even setting aside other computational and
statistical concerns (e.g. {[}@Cressie2009{]}), these approaches do not
address our second concern - representing uncertainty outside the
observed data range.

\href{http://dx.doi.org/10.1890/07-0744.1}{@Cressie2009}.

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Limits of state space
\end{itemize}

Often the set of feasible states is larger than the range of the
observed states. Though a system can enter a state outside previously
observed values due to stochastic effects alone (such as a particularly
low or high nutrient year), this concern is most keenly felt in
considering the value of actions that have not yet been applied.

Of all sources of uncertainty, this has potentially recieved the least
attention. It has most often appeared in the concept of active learning
or active adaptive managment, (adaptive probing, ) where it may be
valauble to intentionally force a system far from the observed values
even when the expected value such actions is low, as it provides much
faster learning and consequent reduction of model uncertainty that can
allow greater value to be derived later on. Ludwig and Walters (1982)
show that it may be advantageous to fish an unexploited population very
heavily at first to obtain a better estimate of the recruitment rate.
This intuitive strategy when a population is governed by a Ricker or
Beverton-Holt-like dynamic would clearly be disasterous if instead the
dynamics contained an unforseen tipping point. The best way to learn
where the edge lies may be to walk up to it, but it is also the most
dangerous.

\subsection{Two central challenges:}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  We don't know the model
\item
  We don't have data from where we need it most
\end{itemize}

\subsection{Why we don't know the model}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Complex dynamics
\item
  model choice and model averaging approaches
\end{itemize}

\subsection{Why we don't have data where we need it}

\begin{itemize}
\item
  Concerns of tipping points
\item
  Danger of learning
\item
  MAP
\end{itemize}

Decision making under uncertainty is a ubiquitous challenge of natural
resource management and conservation.
\href{http://doi.org/10.1111/faf.12037}{@Glaser2013}

Here we illustrate how a stochastic dynamic programming (SDP) algorithm
can be driven by the predictions from a Gaussian Process (GP). This
provides two distinct advantages compared with contemporary approaches.
First, using a GP sidesteps the need for an accurate model-based
description of the system dynamics (or a model choice or model-averaging
approach which introduces yet more difficulty).\\Second, unlike
parametric models which can only reflect uncertainty in the
corresponding confidence intervals or posterior distributions of their
parameters, the GP approach provides a state-space dependent
representation of uncertainty. This permits a much greater uncertainty
far from the observed data than near the observed data. These features
allow the GP-SDP approach to find robust management solutions in face of
both limited data and no knolwedge of correct model structure.

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Note on ``not magic'': honest uncertainty + SDP
\end{itemize}

The idea that any approach can perform well without either having to
know the model or have particularly good data should immediately draw
suspicion. The reader must bear in mind that the strength of our
approach comes not from black-box predictive power from such limited
information, but rather, by providing a more honest expression of
uncertainty outside the observed data without sacrificing the predictive
capacity near the observed data. By coupling this more accurate
description of what is known and unknown to the decision-making under
uncertainty framework provided by stochastic dynamic programming, we are
able to obtain more robust management policies than with common
parameteric modeling approaches.

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Note on comparing models (via value function rather than by ``fit'').
  \emph{Do we need this?}
\end{itemize}

The nature of decision-making problems provides a convenient way to
compare models. Rather than compare models in terms of best fit to data
or fret over the appropriate penalty for model complexity, model
performance is defined in the concrete terms of the decision-maker's
objective function, which we will take as given. (Much argument can be
made over the `correct' objective function, e.g.~how to account for the
social value of fish left in the sea vs.~the commercial value of fish
harvested; see Halpern et al. (2013) for further discussion of this
issue. Alternatively, we can always compare model performance across
multiple potential objective functions.) The decision-maker does not
necessarily need a model that provides the best mechanistic
understanding or the best long-term outcome, but rather the one that
best estimates the probabilities of being in different states as a
result of the possible actions.

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Note on terminology: ``Non-parametric'' \emph{Do we need this?}
\end{itemize}

\subsection{Background on the Gaussian Process}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Definition
\item
  Previous application
\item
  Why it is particularly suited to these two problems
\item
  (Why this is a novel application thereof)
\end{itemize}

\section{Approach and Methods}

\subsubsection{Summary of approach}

\subsubsection{Statement of the optimal control problem}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Underlying model
\item
  Available data
\item
  Value function
\end{itemize}

For simplicity we assume profit is simply linear in the realized harvest
(only enforcing the restriction that harvest can not exceed available
stock)

\subsubsection{Parametric models}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Statement of the models
\end{itemize}

We consider three candidate parametric models of the stock-recruitment
dynamics: The Ricker model, the Allen model \href{}{Allen 2005}, the
Myers model. The familiar Ricker model involves two parameters,
corresponding to a growth rate and a carrying capacity, and cannot
support alternative stable state dynamics (though as growth rate
increases it exhibits a periodic attractor that proceeds through
period-doubling into chaos. We will generally focus on dynamics below
the chaotic threshold for the purposes of this analysis.) The Allen
model resembles the Ricker dynamics with an added Allee effect parameter
\href{}{Courchamp}, below which the population cannot persist. The Myers
model also has three parameters and contains an Allee threshold, but has
compensatory rather than over-compensatory density dependence
(resembling a Beverton-Holt curve rather than a Ricker curve at high
densities.)

We assume multiplicative log-normal noise perturbs the growth predicted
by the each of the deterministic model skeletons described above. This
introduces one additional parameter $\sigma$ that must be estimated by
each model.

As we simulate training data from the Allen model (ref section), we will
refer to this as the structurally correct model. The Ricker model is
thus a reasonable approximation of these dynamics far from the Allee
threshold (but lacks threshold dynamics), while the Myers model shares
the essential feature of a threshold but differs in the structure. Thus
we have three potential parametric models of the stock dynamics.

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Bayesian inference of parametric models
\end{itemize}

We infer posterior distributions for the parameters of each model in a
Bayesian context using Gibbs sampling (implemented in R \href{}{R} using
jags, \href{}{jags}). We choose uninformative uniform priors for all
parameters (See Appendix, Figures S1-S3, and Table S1, and the R code
provided). One-step-ahead predictions of these model fits are shown in
Figure 1.

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  SDP via parametric models
\end{itemize}

An optimal policy function is then inferred through stochastic dynamic
programming for each model given the posterior distributions of the
parameter estimates. This policy maximizes the expectation of the value
function integrated over the parameter uncertainty. (code implementing
this algorithm provided in the Appendix).

\subsubsection{The Gaussian Process model}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Statement of model
\end{itemize}

\ldots{} more on GP \ldots{} \href{}{Munch 2005}

We also estimate a simple Gaussian Process defined by a radial basis
function kernel of two parameters: $\ell$, which gives the
characteristic length-scale over which correlation between two points
(e.g.~any two points $X_t, X_{t+1}$, and $X_{t+\tau}, X_{t+1+\tau}$) in
state-space decays, and $\sigma$, which gives the scale of the process
noise by which observations $Y_{t+1}$ may differ from their predicted
values $X_{t+1}$ given an observation of the previous state, $X_t$.

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Inference of the model
\end{itemize}

Also unlike parametric models, this posterior distribution is still
conditional on the training data. As such, the uncertainty near the
observed data.

We use a Metropolis-Hastings Markov Chain Monte Carlo to infer posterior
distributions of the two parameters of the GP (Figure S4, code in
appendix), under weakly informative Gaussian priors (see parameters in
table S5). As the posterior distributions differ substantially from the
priors (Figure S4), we can be assured that most of the information in
the posterior comes from the data rather than the prior belief.

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  SDP via the model
\end{itemize}

Though we are unaware of prior application of this type, it is
reasonably straight-forward to adapt the Gaussian Process for Stochastic
Dynamic Programming. Recall that unlike the parametric models the
Gaussian process with fixed parameters already predicts a distribution
of curves rather than a single curve. We must first integrate over this
distribution of curves given a sampling of parameter values drawn from
the posterior distribution of the two GP parameters, before integrating
over the posterior of those parameters themselves.

\section{Results}

\subsubsection{Figure 1: Fitted Models}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  All models fit the data quite well
\item
  Information criteria would pick the simple, incorrect model.
\end{itemize}

(State-space figure??)

\subsubsection{Figure 2: Inferred Policies}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Inferred policies differ substantially among models
\item
  The structurally correct model and the GP are close to the true model
\item
  alternatives are not close
\end{itemize}

\subsubsection{Figure 3: Simulated results}

-

\subsubsection{Figure 4: Robustness}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Results hold across range of parameters
\end{itemize}

(eek, distinguish better between result and discussion?)

\section{Discussion}

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  All models are ``good fits'' to the originally observed data.
\item
  (Simple model choice immediately leads us astray)
\end{itemize}

\subsection{Future directions}

\subsubsection{Higher dimensions}

\subsubsection{Online learning}

\section{Acknowledgments}

\section{Appendix}

\subsection{Model definitions and estimation}

Equation S1: Ricker model.

\[X_{t+1} = Z_t X_t e^{r \left(1 - \frac{S_t}{K} \right) } \]

Figure S1: Ricker model: prior and posterior distributions for parameter
estimates.

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-unnamed-chunk-1.pdf}
\caption{plot of chunk unnamed-chunk-1}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-unnamed-chunk-2.pdf}
\caption{plot of chunk unnamed-chunk-2}
\end{figure}

Table S1: Parameterization of the priors

\% latex table generated in R 3.0.1 by xtable 1.7-1 package \% Mon Sep 9
14:43:29 2013

\begin{table}[ht]
\centering
\begin{tabular}{rlrr}
  \hline
 & parameter & lower\_bound & upper\_bound \\ 
  \hline
1 & r0 & 0.00 & 10.00 \\ 
  2 & K & 0.00 & 40.00 \\ 
  3 & sigma & 0.00 & 100.00 \\ 
   \hline
\end{tabular}
\end{table}

\[ X_{t+1} = Z_t \frac{r S_t^{\theta}}{1 - \frac{S_t^\theta}{K}} \]

Eq S2: Myers model Figure S2: Myers model: Traces, prior and posterior
distributions for parameter estimates.

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-unnamed-chunk-4.pdf}
\caption{plot of chunk unnamed-chunk-4}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-unnamed-chunk-5.pdf}
\caption{plot of chunk unnamed-chunk-5}
\end{figure}

Table S2: Parameterization of the priors \% latex table generated in R
3.0.1 by xtable 1.7-1 package \% Mon Sep 9 14:43:37 2013

\begin{table}[ht]
\centering
\begin{tabular}{rlrr}
  \hline
 & parameter & lower\_bound & upper\_bound \\ 
  \hline
1 & r0 & 0.00 & 10.00 \\ 
  2 & K & 0.00 & 40.00 \\ 
  3 & theta & 0.00 & 10.00 \\ 
  4 & sigma & 0.00 & 100.00 \\ 
   \hline
\end{tabular}
\end{table}

Eq S3: Allen model

\[f(S_t) = S_t e^{r \left(1 - \frac{S_t}{K}\right)\left(S_t - C\right)} \]

Figure S3: Allen model: prior and posterior distributions for parameter
estimates.

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-unnamed-chunk-7.pdf}
\caption{plot of chunk unnamed-chunk-7}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-unnamed-chunk-8.pdf}
\caption{plot of chunk unnamed-chunk-8}
\end{figure}

Table S3: Parameterization of the priors

\% latex table generated in R 3.0.1 by xtable 1.7-1 package \% Mon Sep 9
14:43:45 2013

\begin{table}[ht]
\centering
\begin{tabular}{rlrr}
  \hline
 & parameter & lower\_bound & upper\_bound \\ 
  \hline
1 & r0 & 0.00 & 10.00 \\ 
  2 & K & 0.00 & 40.00 \\ 
  3 & theta & 0.00 & 10.00 \\ 
  4 & sigma & 0.00 & 100.00 \\ 
   \hline
\end{tabular}
\end{table}

Eq S4: GP model Figure S4: GP model: prior and posterior distributions
for parameter estimates.

\begin{verbatim}
$traces_plot
\end{verbatim}

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-unnamed-chunk-101.pdf}
\caption{plot of chunk unnamed-chunk-10}
\end{figure}

\begin{verbatim}

$posteriors_plot
\end{verbatim}

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-unnamed-chunk-102.pdf}
\caption{plot of chunk unnamed-chunk-10}
\end{figure}

Table S4: Parameterization of the priors

\subsection{Optimal Control Problem}

We seek the harvest policy $h(x)$ that maximizes:

\[ \max_{h_t} \sum_{t \in 0}^{\infty}  \Pi_t(X_t, h_t) \delta^t  \]

subject to the profit function $\Pi(X_t,h)$, discount rate $\delta$, and
the state equation

\[X_{t+1} = Z_t f(S_t)  \] \[S_t = X_t - h_t \]

Where $Z_t$ is multiplicative noise function with mean 1, representing
stochastic growth. We will consider log-normal noise with shape
parameter $\sigma_g$.

Form this we can write down the Bellman recursion as:

\[V_t(x_t) = \max_h \mathbf{E} \left(\Pi(h_t, x_t) + \delta V_{t+1}( Z_{t+1} f(x_t - h_t)) \right)\]

For simplicity we assume profit is simply linear in the realized harvest
(only enforcing the restriction that harvest can not exceed available
stock), $\Pi(h,x) = min(h,x)$.

\subsubsection{Pseudocode for the Bellman iteration}

\begin{Shaded}
\begin{Highlighting}[]
 \NormalTok{V1 <- }\KeywordTok{sapply}\NormalTok{(}\DecValTok{1}\NormalTok{:}\KeywordTok{length}\NormalTok{(h_grid), function(h)\{}
      \NormalTok{delta * F[[h]] %*% V +  }\KeywordTok{profit}\NormalTok{(x_grid, h_grid[h]) }
    \NormalTok{\})}
    \CommentTok{# find havest, h that gives the maximum value}
    \NormalTok{out <- }\KeywordTok{sapply}\NormalTok{(}\DecValTok{1}\NormalTok{:gridsize, function(j)\{}
      \NormalTok{value <- }\KeywordTok{max}\NormalTok{(V1[j,], }\DataTypeTok{na.rm =} \NormalTok{T) }\CommentTok{# each col is a diff h, max over these}
      \NormalTok{index <- }\KeywordTok{which.max}\NormalTok{(V1[j,])  }\CommentTok{# store index so we can recover h's }
      \KeywordTok{c}\NormalTok{(value, index) }\CommentTok{# returns both profit value & index of optimal h.  }
    \NormalTok{\})}
    \CommentTok{# Sets V[t+1] = max_h V[t] at each possible state value, x}
    \NormalTok{V <- out[}\DecValTok{1}\NormalTok{,]                        }\CommentTok{# The new value-to-go}
    \NormalTok{D[,OptTime-time}\DecValTok{+1}\NormalTok{] <- out[}\DecValTok{2}\NormalTok{,]       }\CommentTok{# The index positions}
\end{Highlighting}
\end{Shaded}

\subsubsection{Training data}

Eacho of our models $f(S_t)$ must be estimated from training data, which
we simulate from the Allen model with parameters $r = $
\texttt{r p{[}1{]}}, $K =$ \texttt{r p{[}2{]}}, $C =$
\texttt{r p{[}3{]}}, and $\sigma_g =$ \texttt{r sigma\_g} for $T=$

\begin{verbatim}

Error in base::parse(text = code, srcfile = NULL) : 1:16: unexpected ','
1: Tobs$ timesteps,
                  ^
\end{verbatim}

r Xo`.

\begin{center}\rule{3in}{0.4pt}\end{center}

\section{Abstract}

Decision-theoretic methods often rely on simple parametric models of
ecological dynamics to compare the value of a potential sequence of
actions. Unfortunately, such simple models rarely capture the complexity
or uncertainty found in most real ecosystems.

Further, the data on which a model has been parameterized frequently
fails to cover the possible state-space over which management decisions
must operate. Consequently a model do well in the region of state-space
in which it was estimated, but give erroneous confidence to predictions
outside of that region.

This problem is keenly felt in any system where a potential threshold or
tipping point is a concern. Such a tipping point, if it exists at all,
will lay outside the observed range of the observed data.

We demonstrate how nonparametric Bayesian models can provide robust,
solutions to decision making under uncertainty without knowing the
structural form of the true model.

While methods that account for \emph{parametric} uncertainty can be very
successful with the right model, structural uncertainty of not knowing
what model best approximates the dynamics poses considerably greater
difficulty.

\section{Introduction}

\paragraph{Opening}

\paragraph{Models for decision-making under uncertainty}

Decision-theoretic or optimal control tools require a model that can
assign probabilities of future states (e.g.~stock size of a fishery)
given the current state and a proposed action (e.g.~fishing harvest or
effort).\\Management frequently faces a sequential decision-making
problem -- after selecting an action, the decision-maker may receive new
information about the current state and must again choose an appropriate
action -- such as setting the harvest limits each year based on stock
assessments the year prior.

The decision maker typically seeks to determining the course of actions
(also referred to as the policy) that maximizes the expected value of
some objective function such as net present value derived from the
resource over time.\\Though much can be said on how to choose this value
function appropriately (e.g.~see (Halpern et al.
2013)(http://doi.org/10.1073/pnas.1217689110 ``Achieving the triple
bottom line in the face of inherent trade-offs among social equity,
economic return, and conservation.'')) we will assume this is given.
(Nor is this approach necessarily constrained to maximizing the
expectated value of such a function - the decision-theoretic framework
can be adapted to alternatives such as minimizing the maximum cost or
damage that might be incurred; see Polasky et al. (2011)).

In representing future states with probabilities and maximizing
expectations, this approach provides a natural framework for handling
uncertainty.

The value function typically depends on the action or policy taken, as
well as the state of the system, in each interval of time. The state of
the system, in turn, is usually described by a dynamical model.

\paragraph{Parametric uncertainty}

\paragraph{Structural Uncertainty}

(B. K. Williams 2001; Athanassoglou and Xepapadeas 2012).

While simple mechanistic models can nevertheless provide important
insights into long-term outcomes, such approaches are not well-suited
for use in forecasting outcomes of potential management options.
Non-parametric approaches offer a more flexible alternative that can
both more accurately reflect the data available while also representing
greater uncertainty in areas (of state-space) where data is lacking.

We demonstrate how a Gaussian Process model of stock recruitment can
lead to nearly optimal management through stochastic dynamic
programming, comperable to knowing the correct structural equation for
the underlying simulation. Meanwhile, parametric models that do not
match the underlying dynamics can perform very poorly, even though they
fit the data as well as the true model.\\Ecological research and
management strategy should pay closer attention to the opportunities and
challenges nonparametric modeling can offer.

\section{Approach and Methods}

\subsection{The optimal control problem in fisheries management}

In our example, we focus on the problem in which a manager must set the
harvest level for a marine fishery each year to maximize the net present
value of the resource, given an estimated stock size from the year
before.

To permit comparisons against a theoretical optimum we will consider
data on the stock dynamics simulated from a simple parametric model in
which recruitment of the fish stock $X_{t+1}$ in the following year is a
stochastic process governed by a function $f$ of the current stock
$X_t$, selected harvest policy $h_t$, and noise process $Z$,

\[X_{t+1} = Z_t f(X_t, h_t) \]

Given parameters for the function $f$ and probability distribution $Z$,
along with a given economic model determining the price/profit
$\Pi(X_t, h_t)$ realized in a given year given a choice of harvest $h_t$
and observed stock $X_t$. This problem can be solved exactly for
discretized values of stock $X$ and policy $h$ using stochastic dynamic
programming (SDP) (Mangel 1985). Problems of this sort underpin much
marine fisheries management today.

A crux of this approach is correctly specifying the functional form of
$f$, along with its parameters. The standard approach uses one of a
handful of common parametric models representing the stock-recruitment
relationship, usually after estimating the model parameters from any
available existing data. Uncertainty in the parameter estimates can be
estimated and integrated over to determine the optimal policy under
under uncertainty (Mangel 1985; Schapaugh and Tyre 2013). Uncertainty in
the model structure itself can only be addressed in this approach by
hypothesizing alternative model structures, and then performing some
model choice or model averaging (B. K. Williams 2001; Athanassoglou and
Xepapadeas 2012).

\subsection{Underlying Model}

Concerns over the potential for tipping points in ecological dynamics
(Scheffer et al. 2001) highlight the dangers of uncertainty in
ecological management and pose a substantial challenge to existing
decision-theoretic approaches (Brozović and Schlenker 2011). Because
intervention is often too late after a tipping point has been crossed
(but see Hughes et al. (2013)), management is most often concerned with
avoiding potentially catastrophic tipping points before any data is
available at or following a transition that would more clearly reveal
these regime shift dynamics (e.g. Bestelmeyer et al. 2012).

To illustrate the value of the non-parametric Bayesian approach to
management, we focus on example of a system containing such a tipping
point whose dynamics can still be described by a simple, one-dimensional
parametric model.\\We will focus on a simple parametric model for a
single species (derived from fist principles by Allen et al. 2005) as
our underlying ``reality''.

\[X_{t+1} = Z_t f(S_t)  \] \[S_t = X_t - h_t \]
\[f(S_t) = S_t e^{r \left(1 - \frac{S_t}{K}\right)\left(S_t - C\right)} \]

Where $Z_t$ is multiplicative noise function with mean 1, representing
stochastic growth. We will consider log-normal noise with shape
parameter $\sigma_g$. We start with an example in which the parameters
are $r =2$, $K=8$, $C=5$ and $\sigma_g = 0.1$.

As a low-dimensional system completely described by three parameters,
this scenario should if anything be favorable to a parametric-based
approach. This model contains an Allee effect, or tipping point, below
which the population is not self-sustaining and shrinks to zero
(Courchamp, Berec, and Gascoigne 2008).

\paragraph{Simulated training data}

We generate initial observational data under the model described in Eq 1
for $T_{\textrm{obs}}=40$ time steps, under a given arbitrary sequence
of harvest intensities, $h_t$. We consider the case in which most of the
data comes from a limited region of state space (e.g.~near a stable
equilibrium), leaving us without observations of the population dynamics
at very low levels which would be useful in discrimating between
recruitment curves {[}@{]} or demonstrating the existence of a tipping
point (Scheffer et al. 2001).\\Using data simulated from a specified
model rather than empirical data permits the comparison against the true
underlying dynamics, setting a bar for the optimal performance possible.

\subsubsection{Parametric Models}

We consider three candidate parametric models for the stock-recruitment
function, which we refer to by the first authors of the publications in
which they were first proposed.

We generate the data with a four-parameter model that contains a tipping
point, as discussed above (equation 1), (an Allee effect, see {[}@Allen,
@Courchamp{]}) below which the stock decreases to zero,

\[ X_{t+1} = Z_t S_t e^{r \left(1 - \frac{S_t}{K}\right)\left(\frac{S_t - \theta}{K}\right)} \]

\[ S_t = X_t - h_t \]

The parameter $C$ reflects the location of the tipping point, $K$ the
carrying capacity of the stock, and $r$ the base recruitment rate. $S_t$
represents the stock size after a harvest $h_t$ has been implemented.
$Z_t$ represents a log-normal random variable of log-mean zero and
log-standard deviation parameter $\sigma$.

We consider two alternative candidate models: the Ricker {[}@Ricker{]}
stock-recruitment curve,

\[X_{t+1} = Z_t X_t e^{r \left(1 - \frac{S_t}{K} \right) } \]

and an alternative four-parameter model adapted from @Myers,

\[ X_{t+1} = Z_t \frac{r S_t^{\theta}}{1 - \frac{S_t^\theta}{K}} \]

which contains a tipping point for $\theta > 2$ and becomes a
Beverton-Holt model at $\theta = 1$.

\subsubsection{Bayesian Inference of Parametric models}

Given the sample data, we infer posterior distributions for each of the
three models listed above using a Markov Chain Monte Carlo Gibbs Sampler
(jags, see appendix for implementation details and code) given uniform
priors. We run six chains for $10^6$ steps each and then assess
convergence by Gelman-Rubin criterion and inspection of the traces, see
appendix.

\subsubsection{The Non-parametric Bayesian alternative for
stock-recruitment curves}

\paragraph{Terminology: ``Non-parametric''}

The term non-parametric to describe modeling approaches such as Gaussian
processes is a common source of confusion, notwithstanding the fact that
the model is still specified by parameters. Some literature has
introduced the term ``semi-parametric'' in tacit acknowledgment of this,
which no doubt only contributes to the confusion. The problem is further
exacerbated by the several meanings assigned to the term in statistics:
(a) that the method does not assume some particular probability
distribution (e.g.~a non-parametric bootstrap) or (b) that the method
does not assume a fixed structure to the model. Our use is that of (b),
in contrast to the classical approaches that do. The difference is
clearest by way of example.

The use of Gaussian process (GP) regression (or ``kriging'' in the
geospatial literature) to formulate a predictive model is relatively new
in the context of modeling dynamical systems (Kocijan et al. 2005) and
introduced in the ecological modeling and fisheries management by Munch
et al. (2005). An accessible and thorough introduction to the
formulation and use of GPs can be found in Rasmussen and Williams
(2006).

The essence of the GP approach can be captured in the following thought
experiment: An exhaustive parametric approach to the challenge of
structural uncertainty might proceed by writing down all possible
functional forms for the underlying dynamical system with all possible
parameter values for each form, and then consider searching over this
huge space to select the most likely model and parameters; or using a
Bayesian approach, assign priors to each of these possible models and
infer the posterior distribution of possible models. The GP approach can
be thought of as a computationally efficient approximation to this
approach. GPs represent a large class of models that can be though of as
capturing or reasonably approximating the set of models in this
collection. By modeling at the level of the process, rather than the
level of parametric equation, we can more concisely capture the possible
behavior of these curves. In place of a parametric model of the
dynamical system, the GP approach postulates a prior distribution of
(n-dimensional) curves that can be though of as approximations to a
range of possible (parametric) models that might describe the data. The
GP allows us to consider probabilities on a large set of possible curves
simultaneously.

The posterior distribution for the hyper-parameters of the Gaussian
process model are estimated by Metropolis-Hastings algorithm, again with
details and code provided in the Appendix. Rasmussen and Williams (2006)
provides an excellent general introduction to Gaussian Processes and
Munch et al. (2005) first discusses their application in the context of
population dynamics models such as fisheries stock-recruitment
relationships.

\subsubsection{SDP via GP}

Once the posterior Gaussian process (GP) has been estimated (e.g.~see
Munch et al. 2005), it is necessary to adapt it in place of the
parametric equation for the stochastic dynamic programming (SDP)
solution (see Mangel and Clark 1988 for a detailed description of
parametric SDP methods) to the optimal policy. The essence of the idea
is straight forward -- we will use the estimated GP in place of the
parametric growth function to determine the stochastic transition matrix
on which the SDP calculations are based. The SDP is solved in a
discretized state space -- both the continuously valued population
densities $X$ and harvest quotas $h$ are first mapped to a bounded,
discrete grid. (For simplicity we will consider a uniform grid, though
for either parametric or GP-based SDP it is often advantageous to use a
non-uniform discretization such as a basis function representation,
e.g.~see (Deisenroth, Rasmussen, and Peters 2009)).

The SDP approach then computes a transition matrix, $\mathbf{F}$. We
demonstrate that calculation is just as straight forward based on the GP
as it is in the classical context using the parametric model. The
${i,j}$ of the transition matrix $F$ entry gives the probability of
transitioning into state $x_i$ given that the system is in state $x_j$
in the previous time-step. To generate the transition matrix based on
the posterior GP, we need only the expected values at each grid point
and the corresponding variances (the diagonal of the covariance matrix),
as shown in Figure 1. Given the mean of the GP posterior at each
grid-point as the vector $E$ and variance at that point as vector $V$,
the probability of transitioning from state $x_i$ to state $x_j$ is

\[\mathcal{N}\left(x_j \vert  \mu = E_i, \sigma = \sqrt{V_i}\right)\]

where $\mathcal{N}$ is the Normal density at $x_j$ with mean $\mu$ and
variance $\sigma^2$. Strictly speaking, the transition probability
should be calculated by integrating the normal density over the bin of
width $\Delta$ centered at $x_j$. For a sufficiently fine grid that
$f(x_j) \approx f(x_j + \Delta)$, it is sufficient to calculate the
density at $x_j$ and then row-normalize the transition matrix. The
process can then be repeated for each possible discrete value of our
control variable, (harvest $h$).

\textbf{Pseudocode for the determining the transition matrix from the
GP}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{for(h in h_grid)}
  \NormalTok{F_h = for(x_j in grid)}
          \NormalTok{for(i in }\DecValTok{1}\NormalTok{:N) }
            \KeywordTok{dnorm}\NormalTok{(x_j, mu[i]-h, V[i])}
\end{Highlighting}
\end{Shaded}

Using the discrete transition matrix we may write down the Bellman
recursion defining the stochastic dynamic programming iteration:

\begin{equation}
V_t(x_t) = \max_h \mathbf{E} \left( h_t + \delta V_{t+1}( Z_{t+1} f(x_t - h_t)) \right)
\end{equation}

where $V(x_t)$ is the value of being at state $x$ at time $t$, $h$ is
control (harvest level) chosen. Numerically, the maximization is
accomplished as follows. Consider the set of possible control values to
be the discrete values corresponding the grid of stock sizes. Then for
each $h_t$ there is a corresponding transition matrix $\mathbf{F}_h$
determined as described above but with mean $\mu = x_j - h_t$. Let
$\vec{V_t}$ be the vector whose $i$th element corresponds to the value
of having stock $x_i$ at time $t$. Then let $\Pi_h$ be the vector whose
$i$th element indicates the profit from harvesting at intensity $h_t$
given a population $x_i$ (e.g. $\max(x_i, h_t)$ since one cannot harvest
more fish then the current population size). Then the Bellman recursion
can be given in matrix form as

\[V_{t} = \max_h \left( \Pi_{h_{t}} + \delta \mathbf{F}_h V_{t+1} \right)\]

where the sum is element by element and the expectation is computed by
the matrix multiplication $\mathbf{F} V_{t+1}$.

\subsubsection{Pseudocode for the Bellman iteration}

\begin{Shaded}
\begin{Highlighting}[]
 \NormalTok{V1 <- }\KeywordTok{sapply}\NormalTok{(}\DecValTok{1}\NormalTok{:}\KeywordTok{length}\NormalTok{(h_grid), function(h)\{}
      \NormalTok{delta * F[[h]] %*% V +  }\KeywordTok{profit}\NormalTok{(x_grid, h_grid[h]) }
    \NormalTok{\})}
    \CommentTok{# find havest, h that gives the maximum value}
    \NormalTok{out <- }\KeywordTok{sapply}\NormalTok{(}\DecValTok{1}\NormalTok{:gridsize, function(j)\{}
      \NormalTok{value <- }\KeywordTok{max}\NormalTok{(V1[j,], }\DataTypeTok{na.rm =} \NormalTok{T) }\CommentTok{# each col is a diff h, max over these}
      \NormalTok{index <- }\KeywordTok{which.max}\NormalTok{(V1[j,])  }\CommentTok{# store index so we can recover h's }
      \KeywordTok{c}\NormalTok{(value, index) }\CommentTok{# returns both profit value & index of optimal h.  }
    \NormalTok{\})}
    \CommentTok{# Sets V[t+1] = max_h V[t] at each possible state value, x}
    \NormalTok{V <- out[}\DecValTok{1}\NormalTok{,]                        }\CommentTok{# The new value-to-go}
    \NormalTok{D[,OptTime-time}\DecValTok{+1}\NormalTok{] <- out[}\DecValTok{2}\NormalTok{,]       }\CommentTok{# The index positions}
\end{Highlighting}
\end{Shaded}

This completes the algorithm adapting the GP to the sequential
decision-making problem through SDP, which has not been previously
demonstrated.\\We further provide an R package implementation as
described in the supplemental materials.

\subsubsection{Estimating parametric models}

We estimate posterior distributions for two parametric models: one using
the structurally correct model as given in Eq (1), which we refer to as
the ``Parametric Bayes'' model, and another using the familiar Ricker
model, using a Gibbs sampler as described (with source code) in the
appendix). In addition we estimate the parameters of the structurally
correct model by maximum likelihood.

\section{Results}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{require}\NormalTok{(MASS)}
\NormalTok{step_ahead <- function(x, f, p)\{}
  \NormalTok{h = }\DecValTok{0}
  \NormalTok{x_predict <- }\KeywordTok{sapply}\NormalTok{(x, f, h, p)}
  \NormalTok{n <- }\KeywordTok{length}\NormalTok{(x_predict) - }\DecValTok{1}
  \NormalTok{y <- }\KeywordTok{c}\NormalTok{(x[}\DecValTok{1}\NormalTok{], x_predict[}\DecValTok{1}\NormalTok{:n])}
  \NormalTok{y}
\NormalTok{\}}
\NormalTok{step_ahead_posteriors <- function(x)\{}
\NormalTok{gp_f_at_obs <- }\KeywordTok{gp_predict}\NormalTok{(gp, x, }\DataTypeTok{burnin=}\FloatTok{1e4}\NormalTok{, }\DataTypeTok{thin=}\DecValTok{300}\NormalTok{)}
\NormalTok{df_post <- }\KeywordTok{melt}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(}\KeywordTok{sample}\NormalTok{(}\DecValTok{100}\NormalTok{), }
  \NormalTok{function(i)\{}
    \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{time =} \DecValTok{1}\NormalTok{:}\KeywordTok{length}\NormalTok{(x), }\DataTypeTok{stock =} \NormalTok{x, }
                \DataTypeTok{GP =} \KeywordTok{mvrnorm}\NormalTok{(}\DecValTok{1}\NormalTok{, gp_f_at_obs$Ef_posterior[,i], gp_f_at_obs$Cf_posterior[[i]]),}
                \DataTypeTok{True =} \KeywordTok{step_ahead}\NormalTok{(x,f,p),  }
                \DataTypeTok{MLE =} \KeywordTok{step_ahead}\NormalTok{(x,f,est$p), }
                \DataTypeTok{Allen =} \KeywordTok{step_ahead}\NormalTok{(x, allen_f, pardist[i,]), }
                \DataTypeTok{Ricker =} \KeywordTok{step_ahead}\NormalTok{(x, ricker_f, ricker_pardist[i,]), }
                \DataTypeTok{Myers =} \KeywordTok{step_ahead}\NormalTok{(x, myers_f, myers_pardist[i,]))}
  \NormalTok{\}), }\DataTypeTok{id=}\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\StringTok{"stock"}\NormalTok{))}
\NormalTok{\}}

\NormalTok{df_post <- }\KeywordTok{step_ahead_posteriors}\NormalTok{(x)}

\KeywordTok{ggplot}\NormalTok{(df_post) + }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(time, stock)) + }
  \KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(time, value, }\DataTypeTok{col=}\NormalTok{variable, }\DataTypeTok{group=}\KeywordTok{interaction}\NormalTok{(L1,variable)), }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{1}\NormalTok{) + }
  \KeywordTok{scale_colour_manual}\NormalTok{(}\DataTypeTok{values=}\NormalTok{colorkey, }\DataTypeTok{guide =} \KeywordTok{guide_legend}\NormalTok{(}\DataTypeTok{override.aes =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{alpha =} \DecValTok{1}\NormalTok{))) }
\end{Highlighting}
\end{Shaded}

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-Figureb.pdf}
\caption{plot of chunk Figureb}
\end{figure}

Figure 1 shows the mean inferred state space dynamics of each model
relative to the true model used to generate the data, predicting the
relationship between observed stock size (x-axis) to the stock size
after recruitment the following year. All models except the MLE model
estimate a distribution around the means shown here, and all models
estimate a level of process noise, which is independent of the state
value (x). Note that in contrast to the other models shown, the mean
Gaussian process corresponds to a distribution of curves - as indicated
by the gray band - which itself has a mean shown in black. Note that
this mean GP is thus more certain of the dynamics in the region where
data is available then where it is not.

While it would be natural (and straight forward) to condition the GP on
passing through the origin (0,0) (see appendix), the estimate shown here
is based only on the observed data. The observed data from which each
model is estimated is also shown. The observations come from only a
limited region of state space corresponding to unharvested or weakly
harvested system. No observations occur at the theoretical optimum or
near the tipping point.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{policies <- }\KeywordTok{melt}\NormalTok{(}\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{stock=}\NormalTok{x_grid, }\KeywordTok{sapply}\NormalTok{(OPT, function(x) x_grid[x])), }\DataTypeTok{id=}\StringTok{"stock"}\NormalTok{)}
\KeywordTok{names}\NormalTok{(policies) <- }\KeywordTok{c}\NormalTok{(}\StringTok{"stock"}\NormalTok{, }\StringTok{"method"}\NormalTok{, }\StringTok{"value"}\NormalTok{)}

\KeywordTok{ggplot}\NormalTok{(policies, }\KeywordTok{aes}\NormalTok{(stock, stock - value, }\DataTypeTok{color=}\NormalTok{method)) +}
  \KeywordTok{geom_line}\NormalTok{(}\DataTypeTok{lwd=}\FloatTok{1.2}\NormalTok{, }\DataTypeTok{alpha=}\FloatTok{0.8}\NormalTok{) + }\KeywordTok{xlab}\NormalTok{(}\StringTok{"stock size"}\NormalTok{) + }\KeywordTok{ylab}\NormalTok{(}\StringTok{"escapement"}\NormalTok{)  +}
  \KeywordTok{scale_colour_manual}\NormalTok{(}\DataTypeTok{values=}\NormalTok{colorkey)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-Figure2.pdf}
\caption{The steady-state optimal policy (infinite boundary) calculated
under each model. Policies are shown in terms of target escapement,
$S_t$, as under models such as this a constant escapement policy is
expected to be optimal (Reed 1979).}
\end{figure}

The resulting optimal management strategy based on each of the inferred
models is shown in Figure 2, against the optimal strategy given the true
underlying dynamics. Policies are shown in terms of target escapement,
$S_t$. Under models such as this a constant escapement policy is
expected to be optimal (Reed 1979), whereby population levels below a
certain size $S$ are unharvested, while above that size the harvest
strategy aims to return the population to $S$, resulting in the
hockey-stick shaped policies shown.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(sims_data) + }
  \KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(time, fishstock, }\DataTypeTok{group=}\KeywordTok{interaction}\NormalTok{(reps,method), }\DataTypeTok{color=}\NormalTok{method), }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{1}\NormalTok{) +}
  \KeywordTok{scale_colour_manual}\NormalTok{(}\DataTypeTok{values=}\NormalTok{colorkey, }\DataTypeTok{guide =} \KeywordTok{guide_legend}\NormalTok{(}\DataTypeTok{override.aes =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{alpha =} \DecValTok{1}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-Figure3.pdf}
\caption{Gaussian process inference outperforms parametric estimates.
Shown are 100 replicate simulations of the stock dynamics (eq 1) under
the policies derived from each of the estimated models, as well as the
policy based on the exact underlying model.}
\end{figure}

The consequences of managing 100 replicate realizations of the simulated
fishery under each of the policies estimated is shown in Figure 3. As
expected from the policy curves, the structurally correct model
under-harvests, leaving the stock to vary around it's un-fished optimum.
The structurally incorrect Ricker model over-harvests the population
passed the tipping point consistently, resulting in the immediate crash
of the stock and thus derives minimal profits.

The results shown in Figures 1-3 are not unique to the simulated data or
models chosen here, but arises across a range of parameter values and
simulations as shown in the supplemental figures. The results across
this range can most easily be compared by the relative differences in
net present value realized by each of the approaches, as shown in Figure
4. The Gaussian Process most consistently realizes a value close to the
optimal solution, and importantly avoids ever driving the system across
the tipping point, which results in the near-zero value cases in the
parametric models.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fig4v1 <- }\KeywordTok{ggplot}\NormalTok{(actual_over_optimal, }\KeywordTok{aes}\NormalTok{(value)) + }\KeywordTok{geom_histogram}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{fill=}\NormalTok{variable)) + }
  \KeywordTok{facet_wrap}\NormalTok{(~variable, }\DataTypeTok{scales =} \StringTok{"free_y"}\NormalTok{)  + }\KeywordTok{guides}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{) +}
  \KeywordTok{xlab}\NormalTok{(}\StringTok{"Total profit by replicate"}\NormalTok{) + }\KeywordTok{scale_fill_manual}\NormalTok{(}\DataTypeTok{values=}\NormalTok{colorkey) }\CommentTok{# density plots fail when delta fn}

\NormalTok{fig4v2 <- }\KeywordTok{ggplot}\NormalTok{(actual_over_optimal, }\KeywordTok{aes}\NormalTok{(value)) + }\KeywordTok{geom_histogram}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{fill=}\NormalTok{variable), }\DataTypeTok{binwidth=}\FloatTok{0.1}\NormalTok{) + }
  \KeywordTok{xlab}\NormalTok{(}\StringTok{"Total profit by replicate"}\NormalTok{)+ }\KeywordTok{scale_fill_manual}\NormalTok{(}\DataTypeTok{values=}\NormalTok{colorkey)}

\NormalTok{fig4v3 <- }\KeywordTok{ggplot}\NormalTok{(actual_over_optimal, }\KeywordTok{aes}\NormalTok{(value, }\DataTypeTok{fill=}\NormalTok{variable, }\DataTypeTok{color=}\NormalTok{variable)) + }\CommentTok{# density plots fail when delta fn}
  \KeywordTok{stat_density}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y=}\NormalTok{..density..), }\DataTypeTok{position=}\StringTok{"stack"}\NormalTok{, }\DataTypeTok{adjust=}\DecValTok{3}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{.}\DecValTok{9}\NormalTok{) + }
  \KeywordTok{xlab}\NormalTok{(}\StringTok{"Total profit by replicate"}\NormalTok{)+ }\KeywordTok{scale_fill_manual}\NormalTok{(}\DataTypeTok{values=}\NormalTok{colorkey)+ }\KeywordTok{scale_color_manual}\NormalTok{(}\DataTypeTok{values=}\NormalTok{colorkey)}
\NormalTok{fig4v2}
\end{Highlighting}
\end{Shaded}

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-Figure41.pdf}
\caption{Histograms of the realized net present value of the fishery
over a range of simulated data and resulting parameter estimates. For
each data set, the three models are estimated as described above. Values
plotted are the averages of a given policy over 100 replicate
simulations. Details and code provided in the supplement.}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fig4v3}
\end{Highlighting}
\end{Shaded}

\begin{figure}[htbp]
\centering
\includegraphics{figure/nonparametric-bayes-Figure42.pdf}
\caption{Histograms of the realized net present value of the fishery
over a range of simulated data and resulting parameter estimates. For
each data set, the three models are estimated as described above. Values
plotted are the averages of a given policy over 100 replicate
simulations. Details and code provided in the supplement.}
\end{figure}

\section{Discussion}

\paragraph{Big picture: Linking GP to SDP}

Non-parametric Bayesian methods have received far too little attention
in ecological modeling efforts that are aimed at improved conservation
planning and decision making support. Such approaches may be
particularly useful when the available data is restricted to a limited
area of state-space, which can lead parametric models to underestimate
the uncertainty in dynamics at population levels (states) which have not
been observed. One reason for the relative absence of nonparametric
approaches in the natural resource management context may be the lack of
existing approaches for adapting the non-parametric Bayesian models
previously proposed (Munch et al. 2005) to a decision-theoretic
framework. Adapting a non-parametric approach requires modification of
existing methods for decision theory. We have illustrated how this might
be done for a classic stochastic dynamic programming problem, opening
the door for substantial further research into how these applications
might be improved.

Though simple mechanistically motivated models may be best for the
latter case (Cuddington, Fortin, and Gerber 2013; Geritz and Kisdi
2012), such models can be not only inaccurate but misleading in
quantitative decision making. This arises for two reasons:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\itemsep1pt\parskip0pt\parsep0pt
\item
  We do not know what the correct parameter values are for the models.
\item
  We do not know what the correct models are for ecological systems.
\end{enumerate}

The complexity of ecological interactions and a lack of data contribute
greatly to both of the problems. This concern is particularly acute in
case of ecological tipping points (Barnosky et al. 2012; Scheffer et al.
2001), which arise from feedbacks common in ecological systems and can
lead to a sudden catastrophic transition to an undesirable state. In
general we do not know where such tipping points are unless we have
already observed the transition, in which case it is frequently too late
to respond. Though there may exist early warning signals for certain
kinds of these transitions that are driven by slow changes (Scheffer et
al. 2009), we do not know when, where, or how to apply them to the
decision making context more generally (Boettiger and Hastings 2013).

While non-parametric Bayesian approaches will not always be preferable
to simple mechanistic models, we highlight three aspects of the problem
consider here that make these methods particularly valuable. These
aspects are common to many conservation decision making problems, which
thus merit greater use of non-parametric approaches that can best take
advantage of them.

\subsubsection{1. Large uncertainty where the data is poor}

The parametric models perform worst when they propose a management
strategy outside the range of the observed data. The non-parametric
Bayesian approach, in contrast, allows a predictive model that expresses
a great deal of uncertainty about the probable dynamics outside the
observed range, while retaining very good predictive accuracy in the
range observed. The management policy dictated by the GP balance this
uncertainty against the immediate value of the harvest, and act to
stabilize the population dynamics in a region of state space in which
the predictions can be reliably reflected by the data.

\subsubsection{2. Predictive accuracy where data is good}

While expressing larger uncertainty outside the observed data, the GP
can also provide a better fit with smaller uncertainty inside the range
of the observed data. This arises from the greater flexibility of the
Gaussian process, which describes a large family of possible
curves.\\While in a parametric context this over-fitting would be more
worrisome -- a high-degree polynomial could fit the data even better --
those concerns are driven by the resulting parametric fit outside the
data, which may involve wild oscillations unsupported by the data. As we
have seen in \#1, the GP is less vulnerable to such unjustified
predictions outside the data, and is meanwhile free to benefit from the
greater fit where the data is available.

\subsection{Future directions}

\subsubsection{Higher dimensions}

In this simulated example, the underlying dynamics are truly governed by
a simple parametric model, allowing the parametric approaches to be more
accurate. Similarly, because the dynamics are one-dimensional dynamics
and lead to stable nodes (rather than other attractors such as
limit-cycles resulting in oscillations), the training data provides
relatively limited information about the dynamics. For these reasons, we
anticipate that in higher-dimensional examples characteristic of
ecosystem management problems that the machine learning approach will
prove even more valuable.

\subsubsection{Online learning}

In our treatment here we have ignored the possibility of learning during
the management phase, in which the additional observations of the stock
size could potentially improve parameter estimates. While we intend to
address this possibility in future work in the context of these
non-parametric models, we have not addressed it here for pedagogical
reasons. In the context presented here, it is clear that the differences
in performance arise from differences in the uncertainty inherent in the
model formulations, rather than from differing abilities to learn.
Because we consider a threshold system, online learning would not change
this generic feature of a lack of data in a certain range of the state
space which is better captured by the Gaussian process.

\section{Acknowledgments}

This work was partially supported by the Center for Stock Assessment
Research, a partnership between the University of California Santa Cruz
and the Fisheries Ecology Division, Southwest Fisheries Science Center,
Santa Cruz, CA and by NSF~grant EF-0924195 to MM.

\section{Appendix}

The appendices have not yet been assembled. Meanwhile, code to repeat
the analyses, along with a complete log of all research conducted on
this project, can be found at:
\href{https://github.com/cboettig/nonparametric-bayes/}{https://github.com/cboettig/nonparametric-bayes}

\subsection{Markov Chain Monte Carlo Analysis}

\section{References}

Allen, Linda J. S., Jesse F. Fagan, Göran Högnäs, and Henrik Fagerholm.
2005. ``Population extinction in discrete-time stochastic population
models with an Allee effect.'' \emph{Journal of Difference Equations and
Applications} 11 (4-5) (apr): 273--293.
doi:10.1080/10236190412331335373.
\url{http://www.tandfonline.com/doi/abs/10.1080/10236190412331335373}.

Athanassoglou, Stergios, and Anastasios Xepapadeas. 2012. ``Pollution
control with uncertain stock dynamics: When, and how, to be
precautious.'' \emph{Journal of Environmental Economics and Management}
63 (3) (may): 304--320. doi:10.1016/j.jeem.2011.11.001.
\url{http://linkinghub.elsevier.com/retrieve/pii/S0095069611001409}.

Barnosky, Anthony D., Elizabeth a Hadly, Jordi Bascompte, Eric L.
Berlow, James H. Brown, Mikael Fortelius, Wayne M. Getz, et al. 2012.
``Approaching a state shift in Earth's biosphere.'' \emph{Nature} 486
(7401) (jun): 52--58. doi:10.1038/nature11018.
\url{http://www.nature.com/doifinder/10.1038/nature11018}.

Bestelmeyer, Brandon T., Michael C. Duniway, Darren K. James, Laura M.
Burkett, and Kris M. Havstad. 2012. ``A test of critical thresholds and
their indicators in a desertification-prone ecosystem: more resilience
than we thought.'' Ed. Katharine Suding. \emph{Ecology Letters} (dec).
doi:10.1111/ele.12045. \url{http://doi.wiley.com/10.1111/ele.12045}.

Boettiger, Carl, and Alan Hastings. 2013. ``Tipping points: From
patterns to predictions.'' \emph{Nature} 493 (7431) (jan): 157--158.
doi:10.1038/493157a.
\url{http://www.nature.com/doifinder/10.1038/493157a}.

Brozović, Nicholas, and Wolfram Schlenker. 2011. ``Optimal management of
an ecosystem with an unknown threshold.'' \emph{Ecological Economics}
(jan): 1--14. doi:10.1016/j.ecolecon.2010.10.001.
\url{http://linkinghub.elsevier.com/retrieve/pii/S0921800910004167}.

Courchamp, Franck, Ludek Berec, and Joanna Gascoigne. 2008. \emph{Allee
Effects in Ecology and Conservation}. Oxford University Press, USA.
\url{http://www.amazon.com/Effects-Ecology-Conservation-Franck-Courchamp/dp/0198570309}.

Cuddington, Kim M., M. J. Fortin, and L. R. Gerber. 2013.
``Process-based models are required to manage ecological systems in a
changing world.'' \emph{Ecosphere} 4 (February): 1--12.
doi:10.1890/ES12-00178.1.
\url{http://www.esajournals.org/doi/abs/10.1890/ES12-00178.1}.

Deisenroth, Marc Peter, Carl Edward Rasmussen, and Jan Peters. 2009.
``Gaussian process dynamic programming.'' \emph{Neurocomputing} 72 (7-9)
(mar): 1508--1524. doi:10.1016/j.neucom.2008.12.019.
\url{http://linkinghub.elsevier.com/retrieve/pii/S0925231209000162}.

Geritz, Stefan A. H., and Eva Kisdi. 2012. ``Mathematical ecology: why
mechanistic models?.'' \emph{Journal of mathematical biology} 65 (6-7)
(dec): 1411--5. doi:10.1007/s00285-011-0496-3.
\url{http://www.ncbi.nlm.nih.gov/pubmed/22159789}.

Gordon, H. S. 1954. ``The economic theory of a common-property resource:
the fishery.'' \emph{The Journal of Political Economy} 62 (2): 124--142.
\url{http://www.jstor.org/stable/10.2307/1825571}.

Halpern, Benjamin S., Carissa J. Klein, Christopher J. Brown, Maria
Beger, Hedley S. Grantham, Sangeeta Mangubhai, Mary Ruckelshaus, et al.
2013. ``Achieving the triple bottom line in the face of inherent
trade-offs among social equity, economic return, and conservation.''
\emph{Proceedings of the National Academy of Sciences of the United
States of America} (mar). doi:10.1073/pnas.1217689110.
\url{http://www.ncbi.nlm.nih.gov/pubmed/23530207}.

Hilborn, Ray. 2007. ``Reinterpreting the State of Fisheries and their
Management.'' \emph{Ecosystems} 10 (8) (oct): 1362--1369.
doi:10.1007/s10021-007-9100-5.
\url{http://www.springerlink.com/index/10.1007/s10021-007-9100-5}.

Hughes, Terry P., Cristina Linares, Vasilis Dakos, Ingrid a van de
Leemput, and Egbert H. van Nes. 2013. ``Living dangerously on borrowed
time during slow, unrecognized regime shifts.'' \emph{Trends in ecology
\& evolution} 28 (3) (mar): 149--55. doi:10.1016/j.tree.2012.08.022.
\url{http://www.ncbi.nlm.nih.gov/pubmed/22995893}.

Kocijan, Juš, Agathe Girard, Bla\textbackslash{}vz Banko, and Roderick
Murray-Smith. 2005. ``Dynamic systems identification with Gaussian
processes.'' \emph{Mathematical and Computer Modelling of Dynamical
Systems} 11 (4) (dec): 411--424. doi:10.1080/13873950500068567.
\url{http://www.tandfonline.com/doi/abs/10.1080/13873950500068567}.

Ludwig, Donald, and Carl J. Walters. 1982. ``Optimal harvesting with
imprecise parameter estimates.'' \emph{Ecological Modelling} 14 (3-4)
(jan): 273--292. doi:10.1016/0304-3800(82)90023-0.
\url{http://linkinghub.elsevier.com/retrieve/pii/0304380082900230}.

Mangel, Marc. 1985. ``Decision and control in uncertain resource
systems:'' 255.
\href{http://www.amazon.com/Decision-uncertain-resource-Mathematics-Engineering/dp/0124687202 http://dl.acm.org/citation.cfm?id=537497}{http://www.amazon.com/Decision-uncertain-resource-Mathematics-Engineering/dp/0124687202
http://dl.acm.org/citation.cfm?id=537497}.

Mangel, Marc, and Colin W. Clark. 1988. \emph{Dynamic Modeling in
Behavioral Ecology}. Ed. John Krebs and Tim Clutton-Brock. Princeton:
Princeton University Press.

May, Robert M., John R. Beddington, Colin W. Clark, Sidney J. Holt, and
R. M. Laws. 1979. ``Management of multispecies fisheries.''
\emph{Science (New York, N.Y.)} 205 (4403) (jul): 267--77.
doi:10.1126/science.205.4403.267.
\url{http://www.ncbi.nlm.nih.gov/pubmed/17747032}.

Munch, Stephan B., Melissa L. Snover, George M. Watters, and Marc
Mangel. 2005. ``A unified treatment of top-down and bottom-up control of
reproduction in populations.'' \emph{Ecology Letters} 8 (7) (may):
691--695. doi:10.1111/j.1461-0248.2005.00766.x.
\url{http://doi.wiley.com/10.1111/j.1461-0248.2005.00766.x}.

Polasky, Stephen, Stephen R. Carpenter, Carl Folke, and Bonnie Keeler.
2011. ``Decision-making under great uncertainty: environmental
management in an era of global change.'' \emph{Trends in ecology \&
evolution} (may): 1--7. doi:10.1016/j.tree.2011.04.007.
\url{http://www.ncbi.nlm.nih.gov/pubmed/21616553}.

Rasmussen, Carl Edward, and C. K. I. Williams. 2006. \emph{Gaussian
Processes for Machine Learning}. Ed. Thomas Dietterich. Boston: MIT
Press,. \url{www.GaussianProcess.org/gpml}.

Reed, William J. 1979. ``Optimal escapement levels in stochastic and
deterministic harvesting models.'' \emph{Journal of Environmental
Economics and Management} 6 (4) (dec): 350--363.
doi:10.1016/0095-0696(79)90014-7.
\href{http://www.sciencedirect.com/science/article/pii/0095069679900147 http://linkinghub.elsevier.com/retrieve/pii/0095069679900147}{http://www.sciencedirect.com/science/article/pii/0095069679900147
http://linkinghub.elsevier.com/retrieve/pii/0095069679900147}.

Schapaugh, Adam W., and Andrew J. Tyre. 2013. ``Accounting for
parametric uncertainty in Markov decision processes.'' \emph{Ecological
Modelling} 254 (apr): 15--21. doi:10.1016/j.ecolmodel.2013.01.003.
\url{http://linkinghub.elsevier.com/retrieve/pii/S0304380013000306}.

Scheffer, Marten, Jordi Bascompte, William A. Brock, Victor Brovkin,
Stephen R. Carpenter, Vasilis Dakos, Hermann Held, Egbert H. van Nes,
Max Rietkerk, and George Sugihara. 2009. ``Early-warning signals for
critical transitions.'' \emph{Nature} 461 (7260): 53--9.
\url{http://www.ncbi.nlm.nih.gov/pubmed/19727193}.

Scheffer, Marten, Stephen R. Carpenter, J. A. Foley, C. Folke, and B.
Walker. 2001. ``Catastrophic shifts in ecosystems.'' \emph{Nature} 413
(6856) (oct): 591--6. doi:10.1038/35098000.
\url{http://www.ncbi.nlm.nih.gov/pubmed/11595939}.

Williams, Byron K. 2001. ``Uncertainty , learning , and the optimal
management of wildlife.'' \emph{Environmental and Ecological Statistics}
8: 269--288. doi:10.1023/A:1011395725123.

Worm, Boris, Edward B. Barbier, Nicola Beaumont, J. Emmett Duffy, Carl
Folke, Benjamin S. Halpern, Jeremy B. C. Jackson, et al. 2006. ``Impacts
of biodiversity loss on ocean ecosystem services.'' \emph{Science (New
York, N.Y.)} 314 (5800) (nov): 787--90. doi:10.1126/science.1132294.
\url{http://www.ncbi.nlm.nih.gov/pubmed/17082450}.

Worm, Boris, Ray Hilborn, Julia K. Baum, Trevor A. Branch, Jeremy S.
Collie, Christopher Costello, Michael J. Fogarty, et al. 2009.
``Rebuilding global fisheries.'' \emph{Science (New York, N.Y.)} 325
(5940) (jul): 578--85. doi:10.1126/science.1173146.
\url{http://www.ncbi.nlm.nih.gov/pubmed/19644114}.

\end{document}


